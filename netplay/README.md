[project title here]
====================

Required packages
-----------------

* Currently only Linux and Mac OS X are supported. Windows support is on the 
  horizon.
* Java 7 and up, both JRE and JDK
* [Protobuf](https://github.com/google/protobuf) 3.0.0-beta-1 and up.
* CMake 3.2 and up, including all bundled modules.
* [GTest and GMock](https://github.com/google/googletest)
* [GRPC/GRPC++](https://github.com/grpc/grpc) version exactly 0.10.2 (git tag
  release-0\_10\_2)
* [GPRC-Java](https://github.com/grpc/grpc-java) version 0.9.0 (git HEAD as of 
  08/30/15). Note this repository already includes this dependency as a 
  submodule.
* Mupen64 core, patched with the appropriate updates to support netplay. Note
  this repository already includes this dependency as a submodule.
* If you do not have a GRPC Java protoc plugin for your system, the build 
  toolchain will build one from sourse using the GRPC-java repository in submodulea
  grpc-java. This requires [Gradle](https://gradle.org/).

Build Instructions
------------------

##0. Install all the dependencies listed above##

This project is still in a somewhat embryonic state, and so we recommend you 
install exactly the versions listed above. In practice, all of them except
GRPC/GRPC++ and GRPC-Java are in a pretty stable state, so you can probably get 
away with using the most recent versions. Results may vary, however. 

##1. Generate the build system using CMake##

In theory, you could simply run CMake and hope everything works:

    cmake .

In practice, however, you'll find that CMake needs to be told where the project 
dependencies are. The following environment variables are used to determine the
location of the various dependencies listed above.

Note that these dependencies don't need to be installed on the whole system. 
It's enough to clone the respective repositories, build them in place, and 
pointing the corresponding `ROOT` parameter to the repository directory.

* `GTEST_ROOT`: [GTest](https://github.com/google/googletest)
  installation/source root
* `GMOCK_ROOT`: [GMock](https://github.com/google/googletest) source root.
  Note as of this writing GMock discourages installation in favor of building
  in place.
* `GRPC_ROOT`: [GRPC/GRPC++](https://github.com/grpc/grpc) header and library
  installation/source root.
* `GRPC_JAVA_ROOT`: [GRPC-Java](https://github.com/grpc/grpc-java) source root
  directory.

We also define a number of optional dependencies. For most builds, you can 
simply leave these unset and the build system will automatically point itself at 
the appropriate directory.

* `MUPEN64_ROOT`: Location of Mupen64 API headers. For example,
  `$../mupen64-core/src/api`. Note this repository already already satisfies 
  this dependency in the mupen64plus-core submodule.
* `SKIP_GRPC_JAVA`: The grpc-java build fails, most notably on ARM. Setting this 
  flag to any non-empty-string value will skip building the plugin and assume 
  the user built the plugin manually and placed it into
  `grpc-java/compiler/build/binaries/java_pluginExecutable/protoc-gen-grpc-java`

##2. Build the system##

Once CMake constructs the Makefile, run:

    make

If the build fails at this step, it might indicate an error in the setup of the 
build system or the repository. Please report it... somehow.

##3. Run tests##

This one is easy:

    make test

##Final Outputs##

The final targets generated by this build are:
* client/plugin/mupen64/libMupen64Plugin.[dylib/so/dll]
* server/NetplayServer.jar

Using the Mupen64 plugin
------------------------

In order to use the Mupen64 plugin, build the Mupen64 core library using the
source contained in the mupen64plus-core submodule. Then, using your favorite
frontend, start Mupen64 using the generated core library and the 
libMupen64Plugin library. For example, if you're using the 
mupen64plus-ui-console frontend on OSX, your invocation might look something
like this:

    mupen64 \
        --corelib $NETPLAY_ROOT/mupen64plus-core/projects/unix/libmupen64plus.dylib
        --netplay $NETPLAY_ROOT/client/plugin/mupen64/libMupen64Plugin.dylib

Starting the Netplay server
---------------------------

TODO
